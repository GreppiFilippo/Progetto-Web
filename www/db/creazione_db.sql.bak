CREATE DATABASE mensa_logico;
USE mensa_logico;

CREATE TABLE CATEGORIE (
    idCategoria INT NOT NULL AUTO_INCREMENT,
    nomeCategoria VARCHAR(50) NOT NULL,
    CONSTRAINT PK_CATEGORIE PRIMARY KEY (idCategoria)
);

CREATE TABLE SPECIFICHE_ALIMENTARI (
    idPreferenza INT NOT NULL AUTO_INCREMENT,
    nomeSpecifica VARCHAR(50) NOT NULL,
    CONSTRAINT PK_SPECIFICHE_ALIMENTARI PRIMARY KEY (idPreferenza)
);

CREATE TABLE UTENTI (
    idUtente INT NOT NULL AUTO_INCREMENT,
    email VARCHAR(255) NOT NULL,
    password VARCHAR(255) NOT NULL,
    firstName VARCHAR(50) NOT NULL,
    lastName VARCHAR(50) NOT NULL,
    role VARCHAR(20) NOT NULL,
    matricola VARCHAR(20) NOT NULL,
    phone CHAR(10) NOT NULL,
    CONSTRAINT PK_UTENTI PRIMARY KEY (idUtente),
    CONSTRAINT UQ_UTENTI_EMAIL UNIQUE (email)
);

CREATE TABLE PIATTI (
    idPiatto INT NOT NULL AUTO_INCREMENT,
    nome VARCHAR(50) NOT NULL,
    descrizione VARCHAR(255) NOT NULL,
    prezzo DECIMAL(6,2) NOT NULL,
    disponibilita INT NOT NULL,
    immagine VARCHAR(255) NOT NULL,
    calorie INT NOT NULL,
    idCategoria INT NOT NULL,
    CONSTRAINT PK_PIATTI PRIMARY KEY (idPiatto),
    CONSTRAINT FK_PIATTI_CATEGORIA FOREIGN KEY (idCategoria)
        REFERENCES CATEGORIE(idCategoria)
);

CREATE TABLE PRENOTAZIONI (
    idPrenotazione INT NOT NULL AUTO_INCREMENT,
    importoTotale DECIMAL(8,2) NOT NULL,
    dataOra DATETIME NOT NULL,
    pronto BOOLEAN NOT NULL,
    ritirato BOOLEAN NOT NULL,
    idUtente INT NOT NULL,
    CONSTRAINT PK_PRENOTAZIONI PRIMARY KEY (idPrenotazione),
    CONSTRAINT FK_PRENOTAZIONI_UTENTE FOREIGN KEY (idUtente)
        REFERENCES UTENTI(idUtente)
);

CREATE TABLE PRENOTAZIONI_PIATTI (
    idPrenotazione INT NOT NULL,
    idPiatto INT NOT NULL,
    quantita INT NOT NULL,
    CONSTRAINT PK_PRENOTAZIONI_PIATTI PRIMARY KEY (idPrenotazione, idPiatto),
    CONSTRAINT FK_PRENOT_PIA_PIA FOREIGN KEY (idPiatto)
        REFERENCES PIATTI(idPiatto),
    CONSTRAINT FK_PRENOT_PIA_PRE FOREIGN KEY (idPrenotazione)
        REFERENCES PRENOTAZIONI(idPrenotazione)
);

CREATE TABLE SPECIFICHE_UTENTE (
    idUtente INT NOT NULL,
    idPreferenza INT NOT NULL,
    CONSTRAINT PK_SPECIFICHE_UTENTE PRIMARY KEY (idPreferenza, idUtente),
    CONSTRAINT FK_SPEC_UTE_UTENTE FOREIGN KEY (idUtente)
        REFERENCES UTENTI(idUtente),
    CONSTRAINT FK_SPEC_UTE_SPE FOREIGN KEY (idPreferenza)
        REFERENCES SPECIFICHE_ALIMENTARI(idPreferenza)
);

CREATE TABLE SPECIFICHE_PIATTO (
    idPiatto INT NOT NULL,
    idPreferenza INT NOT NULL,
    CONSTRAINT PK_SPECIFICHE_PIATTO PRIMARY KEY (idPiatto, idPreferenza),
    CONSTRAINT FK_SPEC_PIA_PIA FOREIGN KEY (idPiatto)
        REFERENCES PIATTI(idPiatto),
    CONSTRAINT FK_SPEC_PIA_SPE FOREIGN KEY (idPreferenza)
        REFERENCES SPECIFICHE_ALIMENTARI(idPreferenza)
);
